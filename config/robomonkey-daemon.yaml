# RoboMonkey Daemon Configuration
# This file configures the background daemon for automatic indexing and embedding

# Database Configuration
database:
  # Control schema DSN (REQUIRED)
  control_dsn: "postgresql://postgres:postgres@localhost:5433/robomonkey"

  # Schema prefix for per-repo isolation
  schema_prefix: "robomonkey_"

  # Connection pool size
  pool_size: 10

# Embeddings Configuration
embeddings:
  # Enable/disable automatic embedding generation
  enabled: true
  
  # Backfill embeddings for existing chunks on startup
  backfill_on_startup: true
  
  # Provider: "ollama" or "vllm"
  provider: "ollama"
  
  # Model configuration
  model: "snowflake-arctic-embed2:latest"
  dimension: 1024
  max_chunk_length: 8192
  batch_size: 100
  
  # Provider-specific settings
  ollama:
    base_url: "http://localhost:11434"
  
  vllm:
    base_url: "http://localhost:8000"
    api_key: "local-key"

# Job Workers Configuration
workers:
  # Global concurrency limits
  global_max_concurrent: 4
  max_concurrent_per_repo: 2

  # Worker counts by type
  reindex_workers: 2
  embed_workers: 2
  docs_workers: 1

  # Polling interval (seconds)
  poll_interval_sec: 5

  # Legacy fields (for backward compatibility)
  count: 2
  enabled_job_types:
    - EMBED_REPO
    - EMBED_MISSING
    - INDEX_REPO
    - WATCH_REPO

# Repository Watching
watching:
  # Enable file system watching for indexed repos
  enabled: true
  
  # Debounce interval (seconds) - wait this long after last change
  debounce_seconds: 2
  
  # Patterns to ignore (in addition to .gitignore)
  ignore_patterns:
    - "*.pyc"
    - "__pycache__"
    - ".git"
    - "node_modules"
    - ".venv"

# Daemon Health & Monitoring
monitoring:
  # Heartbeat interval (seconds)
  heartbeat_interval: 30

  # Consider daemon dead after this many seconds without heartbeat
  dead_threshold: 120

  # Log level: DEBUG, INFO, WARNING, ERROR
  log_level: "INFO"

# Logging Configuration
logging:
  # Log level: DEBUG, INFO, WARNING, ERROR
  level: "INFO"

  # Log format
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# Development Mode Settings
dev_mode:
  # Enable development mode features
  enabled: false
  
  # Auto-reload on code changes
  auto_reload: false
  
  # Verbose logging
  verbose: false
