# RoboMonkey Daemon Configuration
# This file configures the background daemon for automatic indexing and embedding

# Database Configuration
database:
  # Control schema DSN (REQUIRED)
  control_dsn: "postgresql://postgres:postgres@localhost:5433/robomonkey"

  # Schema prefix for per-repo isolation
  schema_prefix: "robomonkey_"

  # Connection pool size
  pool_size: 10

# Embeddings Configuration
embeddings:
  # Enable/disable automatic embedding generation
  enabled: true
  
  # Backfill embeddings for existing chunks on startup
  backfill_on_startup: true
  
  # Provider: "ollama" or "vllm"
  provider: "ollama"
  
  # Model configuration
  model: "snowflake-arctic-embed2:latest"
  dimension: 1024
  # Reduced to 4000 chars to stay safely under 8192 token limit
  # (minified JS/dense data can have very poor character:token ratios ~1:2)
  max_chunk_length: 4000
  batch_size: 100
  
  # Provider-specific settings
  ollama:
    base_url: "http://localhost:11434"
  
  vllm:
    base_url: "http://localhost:8000"
    api_key: "local-key"

# Auto-Summary Generation
summaries:
  # Enable/disable automatic summary generation
  enabled: true

  # How often to check for entities needing summaries (minutes: 1-1440)
  # Default: 60 (check every hour)
  # Reduced to 10 minutes for more responsive summary generation
  check_interval_minutes: 10

  # Generate summaries immediately after indexing (not just on schedule)
  generate_on_index: true

  # LLM provider for summary generation: "ollama" or "vllm"
  provider: "ollama"

  # Model to use for generating summaries
  # Using Qwen3 Coder 30B Instruct for better code understanding
  model: "mdq100/Qwen3-Coder-30B-A3B-Instruct:30b"

  # LLM endpoint
  base_url: "http://localhost:11434"

  # Batch size for summary generation (1-100)
  batch_size: 10

# Job Workers Configuration
workers:
  # Global concurrency limits
  global_max_concurrent: 4
  max_concurrent_per_repo: 2

  # Worker counts by type
  reindex_workers: 2
  embed_workers: 2
  docs_workers: 1

  # Polling interval (seconds)
  poll_interval_sec: 5

  # Legacy fields (for backward compatibility)
  count: 2
  enabled_job_types:
    - EMBED_REPO
    - EMBED_MISSING
    - INDEX_REPO
    - WATCH_REPO

# Repository Watching
watching:
  # Enable file system watching for indexed repos
  enabled: true

  # Debounce interval (seconds) - wait this long after last change
  debounce_seconds: 2

  # Patterns to ignore (in addition to .gitignore)
  ignore_patterns:
    - "*.pyc"
    - "__pycache__"
    - ".git"
    - "node_modules"
    - ".venv"

  # File extensions to watch for code changes
  code_extensions:
    - ".py"
    - ".js"
    - ".jsx"
    - ".ts"
    - ".tsx"
    - ".go"
    - ".java"
    - ".ejs"      # EJS templates
    - ".hbs"      # Handlebars templates
    - ".handlebars"
    - ".html"     # HTML with embedded scripts
    - ".htm"
    - ".vue"      # Vue.js components
    - ".svelte"   # Svelte components
    - ".astro"    # Astro components

  # File extensions to watch for documentation changes
  doc_extensions:
    - ".md"       # Markdown
    - ".rst"      # ReStructuredText
    - ".adoc"     # AsciiDoc

# Daemon Health & Monitoring
monitoring:
  # Heartbeat interval (seconds)
  heartbeat_interval: 30

  # Consider daemon dead after this many seconds without heartbeat
  dead_threshold: 120

  # Log level: DEBUG, INFO, WARNING, ERROR
  log_level: "INFO"

# Logging Configuration
logging:
  # Log level: DEBUG, INFO, WARNING, ERROR
  level: "INFO"

  # Log format
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# Development Mode Settings
dev_mode:
  # Enable development mode features
  enabled: false
  
  # Auto-reload on code changes
  auto_reload: false
  
  # Verbose logging
  verbose: false
